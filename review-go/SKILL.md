---
name: review-go
description: Go 后端代码评审技能，聚焦潜在 bug、并发/事务/资源泄露风险、风险路径遗漏（异常、边界、回滚、超时等）。当用户请求 Go 代码 review、PR 评审、排查风险或补测试建议时使用。
---

# Review Go

## 概述

对 Go 后端代码进行风险导向的评审，优先发现会导致线上事故、数据不一致、资源泄露或并发问题的缺陷，并给出修复与测试建议。

## 工作流

1. 收集上下文与范围

   - 明确评审对象：PR diff、具体文件或函数、变更目标与业务约束。
   - 若缺少关键信息（调用链、数据库/缓存语义、SLA），先提出最少必要的问题。

2. 快速定位高风险区域

   - 并发路径（goroutine、channel、锁、共享状态）
   - 事务边界与一致性（数据库/缓存/消息队列）
   - 资源生命周期（连接、文件、上下文、定时器、ticker）
   - 错误处理与超时（ctx、重试、降级）

3. 深入检查风险与缺陷

   - 逐点验证：触发条件、影响范围、复现场景、是否可被测试覆盖。

4. 输出评审结果
   - 按严重度排序列出问题（高/中/低）。
   - 每条包含：位置、问题描述、影响、修复建议、必要的测试建议。

## 重点检查清单（Go 后端）

### 潜在 Bug

- nil 指针、切片越界、map 并发读写。
- 返回值/错误被忽略，或错误被覆盖导致误判。
- 结构体零值误用、时间零值、指针共享导致状态污染。

### 并发风险

- goroutine 泄露：无退出条件、ctx 未传递/未监听、channel 永不关闭。
- channel 使用不当：发送/接收阻塞、关闭后写入、select 缺少 default 或退出条件。
- 锁与原子：死锁、双重锁、锁粒度过大、读写锁误用。
- 竞态：共享变量未保护、复制闭包变量错误。

### 事务与一致性

- 事务未提交/回滚、错误分支漏回滚。
- 读写分离或缓存导致脏读/过期读。
- 先写缓存后写库造成不一致，补偿/重试缺失。
- 幂等性不足：重试/重复消息导致重复写入。

### 资源泄露

- DB/HTTP 连接未关闭，Rows/Body 未 Close。
- context 未设置 deadline/timeout。
- timer/ticker 未 Stop，goroutine 常驻。

### 风险路径遗漏

- 异常路径未处理：解析失败、外部依赖超时、第三方错误码。
- 业务边界缺失：空值、超长输入、未授权访问。
- 回滚与补偿缺失：多步骤操作中途失败后未恢复。

## 输出要求

- 以“问题清单”优先输出，按严重度排序，提供文件/行号（如已知）。
- 避免空泛结论，必须给出可执行修复建议。
- 对无法确认的点明确标注“需补充上下文”。
